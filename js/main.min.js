(()=>{"use strict";var e,t,s,n,o={564:(e,t,s)=>{s.a(e,(async(e,t)=>{try{var n=s(79),o=s(78),r=s(739),i=s(815),a=s(893);let u;var c="";async function d(){let e;const t={async loadTokens(){try{return JSON.parse(localStorage.hassTokens)}catch(e){return}},saveTokens:e=>{localStorage.hassTokens=JSON.stringify(e)}};try{e=await(0,n.xI)(t),authenticated=!0}catch(s){if(s!==o.p)return void alert(`Unknown error: ${s}`);if(t.hassUrl=prompt("What host to connect to?","http://localhost:8123"),!t.hassUrl)return;e=await(0,n.xI)(t),authenticated=!0}c=await(0,r.tq)({auth:e});for(const e of["disconnected","ready","reconnect-error"])c.addEventListener(e,(()=>console.log(`Event: ${e}`)));location.search.includes("auth_callback=1")&&history.replaceState(null,"",location.pathname),window.auth=e,window.connection=c,(0,i.wz)(c).then((e=>{console.log("Logged in as",e),window.user=e}))}function l(e,t){document.querySelectorAll(e).forEach((e=>e.textContent=t.state+"Â°"));let s=new Date(t.last_changed),n=s.getHours(),o=s.getMinutes();o=p(o),document.querySelectorAll(e.replace("-temp","-time")).forEach((e=>e.textContent=`${n}:${o}`))}function h(e,t){window.entities=t;let s=-1,n=-1;Object.keys(t).sort().forEach((e=>{"sensor.pws_temperature"==e?(document.querySelector("#outside .tempwrapper .temp").textContent=t[e].state,f(t[e],"#outside .tempwrapper .temp")):"sensor.pws_temperature_indoor"==e?(document.querySelector("#inside .tempwrapper .temp").textContent=t[e].state,f(t[e],"#inside .tempwrapper .temp")):"sensor.pws_humidity"==e?document.querySelector("#outside .humwrapper .hum").textContent=t[e].state:"sensor.pws_humidity_indoor"==e?document.querySelector("#inside .humwrapper .hum").textContent=t[e].state:"sensor.maximum_temperature_outside"==e?l("#outside .max .max-temp",t[e]):"sensor.maximum_temperature_inside"==e?l("#inside .max .max-temp",t[e]):"sensor.minimum_temperature_outside"==e?l("#outside .min .min-temp",t[e]):"sensor.minimum_temperature_inside"==e?l("#inside .min .min-temp",t[e]):"sensor.pws_rain"==e?s=t[e].state:"sensor.pws_rainrate"==e&&(n=t[e].state)})),s>0&&n>-1&&g(s,n)}function m(){const e=new Date;let t=e.getHours(),s=e.getMinutes();s=p(s);let n=`${e.getDate()}-${e.getMonth()+1}-${e.getFullYear()}`;document.getElementById("clock").innerHTML!=t+":"+s&&(document.getElementById("clock").innerHTML=t+":"+s),document.getElementById("date").innerHTML!=n&&(document.getElementById("date").innerHTML=n)}function p(e){return e<10&&(e="0"+e),e}function f(e,t){let s=Date.parse(e.last_changed),n=!1;(Date.now()-s)/1e3/60>180&&(n=!0),n?document.querySelector(t).classList.add("timedout"):document.querySelector(t).classList.remove("timedout")}function g(e,t){if(0==e)return;let s=document.getElementById("rain"),n="<img src='rain.png' width='70px'>";t>0?n+=`${t}mm/h`:device.Rain>0?n+=`${e}mm`:n="",s.innerHTML!=n&&(s.innerHTML=n,""==n?(s.style.display="none",document.getElementById("date").style.display="block"):(s.style.display="block",document.getElementById("date").style.display="none"))}function v(e){let t,s=0;return function(n){const o=(new Date).getTime(),r=o-s;if(0<r&&r<e){n.preventDefault();const e=new CustomEvent("doubletap",{bubbles:!0,detail:n});n.target.dispatchEvent(e)}else t=setTimeout((()=>clearTimeout(t)),e);s=o}}window.setupEntitiesSubscription=async()=>{u&&(u(),console.log("Sleeping"),await new Promise((e=>setTimeout(e,4e3)))),u=(0,a.o)(c,(e=>h(0,e)))},m(),setInterval(m,6e4),"undefined"!=typeof HA_INSTANCE?(console.log("Logging in with long live access token"),await(async()=>{const e=(0,n.W9)(HA_INSTANCE,HA_SECRET);c=await(0,r.tq)({auth:e})})()):await d(),setupEntitiesSubscription(),document.addEventListener("pointerup",v(500)),document.addEventListener("doubletap",(e=>{(0,i.cb)(c,"homeassistant","toggle",{entity_id:"switch.woonkamer_lamp_switch_0"}),(0,i.cb)(c,"homeassistant","toggle",{entity_id:"switch.smart_plug_3_socket_1"}),(0,i.cb)(c,"homeassistant","toggle",{entity_id:"device_tracker.staande_lamp_2"})})),window.scrollTo(0,0),t()}catch(_){t(_)}}),1)},79:(e,t,s)=>{s.d(t,{W9:()=>d,xI:()=>l});var n=s(953),o=s(78);const r=()=>`${location.protocol}//${location.host}/`,i=e=>1e3*e+Date.now();async function a(e,t,s){const n="undefined"!=typeof location&&location;if(n&&"https:"===n.protocol){const t=document.createElement("a");if(t.href=e,"http:"===t.protocol&&"localhost"!==t.hostname)throw o.F$}const r=new FormData;null!==t&&r.append("client_id",t),Object.keys(s).forEach((e=>{r.append(e,s[e])}));const a=await fetch(`${e}/auth/token`,{method:"POST",credentials:"same-origin",body:r});if(!a.ok)throw 400===a.status||403===a.status?o.Fx:new Error("Unable to fetch tokens");const c=await a.json();return c.hassUrl=e,c.clientId=t,c.expires=i(c.expires_in),c}function c(e,t,s){return a(e,t,{code:s,grant_type:"authorization_code"})}class u{constructor(e,t){this.data=e,this._saveTokens=t}get wsUrl(){return`ws${this.data.hassUrl.substr(4)}/api/websocket`}get accessToken(){return this.data.access_token}get expired(){return Date.now()>this.data.expires}async refreshAccessToken(){if(!this.data.refresh_token)throw new Error("No refresh_token");const e=await a(this.data.hassUrl,this.data.clientId,{grant_type:"refresh_token",refresh_token:this.data.refresh_token});e.refresh_token=this.data.refresh_token,this.data=e,this._saveTokens&&this._saveTokens(e)}async revoke(){if(!this.data.refresh_token)throw new Error("No refresh_token to revoke");const e=new FormData;e.append("token",this.data.refresh_token),await fetch(`${this.data.hassUrl}/auth/revoke`,{method:"POST",credentials:"same-origin",body:e}),this._saveTokens&&this._saveTokens(null)}}function d(e,t){return new u({hassUrl:e,clientId:null,expires:Date.now()+1e11,refresh_token:"",access_token:t,expires_in:1e11})}async function l(e={}){let t,s=e.hassUrl;s&&"/"===s[s.length-1]&&(s=s.substr(0,s.length-1));const i=void 0!==e.clientId?e.clientId:r(),a=!0===e.limitHassInstance;if(e.authCode&&s&&(t=await c(s,i,e.authCode),e.saveTokens&&e.saveTokens(t)),!t){const r=(0,n.mA)(location.search.substr(1));if("auth_callback"in r){const n=(d=r.state,JSON.parse(atob(d)));if(a&&(n.hassUrl!==s||n.clientId!==i))throw o.tx;t=await c(n.hassUrl,n.clientId,r.code),e.saveTokens&&e.saveTokens(t)}}var d,l;if(!t&&e.loadTokens&&(t=await e.loadTokens()),t)return new u(t,e.saveTokens);if(void 0===s)throw o.p;return function(e,t,s,n){s+=(s.includes("?")?"&":"?")+"auth_callback=1",document.location.href=function(e,t,s,n){let o=`${e}/auth/authorize?response_type=code&redirect_uri=${encodeURIComponent(s)}`;return null!==t&&(o+=`&client_id=${encodeURIComponent(t)}`),n&&(o+=`&state=${encodeURIComponent(n)}`),o}(e,t,s,n)}(s,i,e.redirectUrl||function(){const{protocol:e,host:t,pathname:s,search:n}=location;return`${e}//${t}${s}${n}`}(),(l={hassUrl:s,clientId:i},btoa(JSON.stringify(l)))),new Promise((()=>{}))}},815:(e,t,s)=>{s.d(t,{cb:()=>i,nP:()=>o,wz:()=>r});var n=s(113);const o=e=>e.sendMessagePromise(n.xP()),r=e=>e.sendMessagePromise(n.kQ()),i=(e,t,s,o,r,i)=>e.sendMessagePromise(n.cb(t,s,o,r,i))},893:(e,t,s)=>{s.d(t,{o:()=>d});const n=e=>{let t=[];function s(s,n){e=n?s:Object.assign(Object.assign({},e),s);let o=t;for(let t=0;t<o.length;t++)o[t](e)}return{get state(){return e},action(t){function n(e){s(e,!1)}return function(){let s=[e];for(let e=0;e<arguments.length;e++)s.push(arguments[e]);let o=t.apply(this,s);if(null!=o)return o instanceof Promise?o.then(n):n(o)}},setState:s,clearState(){e=void 0},subscribe:e=>(t.push(e),()=>{!function(e){let s=[];for(let n=0;n<t.length;n++)t[n]===e?e=null:s.push(t[n]);t=s}(e)})}},o=(e,t,s,o,r={unsubGrace:!0})=>{if(e[t])return e[t];let i,a,c=0,u=n();const d=()=>{if(!s)throw new Error("Collection does not support refresh");return s(e).then((e=>u.setState(e,!0)))},l=()=>d().catch((t=>{if(e.connected)throw t})),h=()=>{a=void 0,i&&i.then((e=>{e()})),u.clearState(),e.removeEventListener("ready",d),e.removeEventListener("disconnected",m)},m=()=>{a&&(clearTimeout(a),h())};return e[t]={get state(){return u.state},refresh:d,subscribe(t){c++,1===c&&(()=>{if(void 0!==a)return clearTimeout(a),void(a=void 0);o&&(i=o(e,u)),s&&(e.addEventListener("ready",l),l()),e.addEventListener("disconnected",m)})();const n=u.subscribe(t);return void 0!==u.state&&setTimeout((()=>t(u.state)),0),()=>{n(),c--,c||(r.unsubGrace?a=setTimeout(h,5e3):h())}}},e[t]};var r=s(815),i=s(953);const a=(e,t)=>e.subscribeMessage((e=>function(e,t){const s=Object.assign({},e.state);if(t.a)for(const e in t.a){const n=t.a[e];let o=new Date(1e3*n.lc).toISOString();s[e]={entity_id:e,state:n.s,attributes:n.a,context:"string"==typeof n.c?{id:n.c,parent_id:null,user_id:null}:n.c,last_changed:o,last_updated:n.lu?new Date(1e3*n.lu).toISOString():o}}if(t.r)for(const e of t.r)delete s[e];if(t.c)for(const e in t.c){let n=s[e];if(!n){console.warn("Received state update for unknown entity",e);continue}n=Object.assign({},n);const{"+":o,"-":r}=t.c[e],i=(null==o?void 0:o.a)||(null==r?void 0:r.a),a=i?Object.assign({},n.attributes):n.attributes;if(o&&(void 0!==o.s&&(n.state=o.s),o.c&&("string"==typeof o.c?n.context=Object.assign(Object.assign({},n.context),{id:o.c}):n.context=Object.assign(Object.assign({},n.context),o.c)),o.lc?n.last_updated=n.last_changed=new Date(1e3*o.lc).toISOString():o.lu&&(n.last_updated=new Date(1e3*o.lu).toISOString()),o.a&&Object.assign(a,o.a)),null==r?void 0:r.a)for(const e of r.a)delete a[e];i&&(n.attributes=a),s[e]=n}e.setState(s,!0)}(t,e)),{type:"subscribe_entities"});async function c(e){const t=await(0,r.nP)(e),s={};for(let e=0;e<t.length;e++){const n=t[e];s[n.entity_id]=n}return s}const u=(e,t)=>e.subscribeEvents((e=>function(e,t){const s=e.state;if(void 0===s)return;const{entity_id:n,new_state:o}=t.data;if(o)e.setState({[o.entity_id]:o});else{const t=Object.assign({},s);delete t[n],e.setState(t,!0)}}(t,e)),"state_changed"),d=(e,t)=>(e=>(0,i.Y6)(e.haVersion,2022,4,0)?o(e,"_ent",void 0,a):o(e,"_ent",c,u))(e).subscribe(t)},78:(e,t,s)=>{s.d(t,{F$:()=>a,Fx:()=>o,UD:()=>r,bM:()=>n,p:()=>i,tx:()=>c});const n=1,o=2,r=3,i=4,a=5,c=6},739:(e,t,s)=>{s.d(t,{tq:()=>h});var n=s(78),o=s(113),r=s(953);const i=!1,a="auth_required",c="auth_invalid",u="auth_ok";function d(e){if(!e.auth)throw n.p;const t=e.auth;let s=t.expired?t.refreshAccessToken().then((()=>{s=void 0}),(()=>{s=void 0})):void 0;const d=t.wsUrl;function l(e,h,m){i&&console.log("[Auth Phase] New connection",d);const p=new WebSocket(d);let f=!1;const g=()=>{if(p.removeEventListener("close",g),f)return void m(n.Fx);if(0===e)return void m(n.bM);const t=-1===e?-1:e-1;setTimeout((()=>l(t,h,m)),1e3)},v=async e=>{try{t.expired&&await(s||t.refreshAccessToken()),p.send(JSON.stringify(o.j2(t.accessToken)))}catch(e){f=e===n.Fx,p.close()}},_=async e=>{const t=JSON.parse(e.data);switch(i&&console.log("[Auth phase] Received",t),t.type){case c:f=!0,p.close();break;case u:p.removeEventListener("open",v),p.removeEventListener("message",_),p.removeEventListener("close",g),p.removeEventListener("error",g),p.haVersion=t.ha_version,(0,r.Y6)(p.haVersion,2022,9)&&p.send(JSON.stringify(o.gQ())),h(p);break;default:i&&t.type!==a&&console.warn("[Auth phase] Unhandled message",t)}};p.addEventListener("open",v),p.addEventListener("message",_),p.addEventListener("close",g),p.addEventListener("error",g)}return i&&console.log("[Auth phase] Initializing",d),new Promise(((t,s)=>l(e.setupRetry,t,s)))}class l{constructor(e,t){this._handleMessage=e=>{let t=JSON.parse(e.data);Array.isArray(t)||(t=[t]),t.forEach((e=>{const t=this.commands.get(e.id);switch(e.type){case"event":t?t.callback(e.event):(console.warn(`Received event for unknown subscription ${e.id}. Unsubscribing.`),this.sendMessagePromise(o.B1(e.id)).catch((e=>{})));break;case"result":t&&(e.success?(t.resolve(e.result),"subscribe"in t||this.commands.delete(e.id)):(t.reject(e.error),this.commands.delete(e.id)));break;case"pong":t?(t.resolve(),this.commands.delete(e.id)):console.warn(`Received unknown pong response ${e.id}`)}}))},this._handleClose=async()=>{const e=this.commands;if(this.commandId=1,this.oldSubscriptions=this.commands,this.commands=new Map,this.socket=void 0,e.forEach((e=>{"subscribe"in e||e.reject(o.z3(n.UD,"Connection lost"))})),this.closeRequested)return;this.fireEvent("disconnected");const t=Object.assign(Object.assign({},this.options),{setupRetry:0}),s=e=>{setTimeout((async()=>{if(!this.closeRequested)try{const e=await t.createSocket(t);this._setSocket(e)}catch(t){if(this._queuedMessages){const e=this._queuedMessages;this._queuedMessages=void 0;for(const t of e)t.reject&&t.reject(n.UD)}t===n.Fx?this.fireEvent("reconnect-error",t):s(e+1)}}),1e3*Math.min(e,5))};this.suspendReconnectPromise&&(await this.suspendReconnectPromise,this.suspendReconnectPromise=void 0,this._queuedMessages=[]),s(0)},this.options=t,this.commandId=2,this.commands=new Map,this.eventListeners=new Map,this.closeRequested=!1,this._setSocket(e)}get connected(){return void 0!==this.socket&&this.socket.readyState==this.socket.OPEN}_setSocket(e){this.socket=e,this.haVersion=e.haVersion,e.addEventListener("message",this._handleMessage),e.addEventListener("close",this._handleClose);const t=this.oldSubscriptions;t&&(this.oldSubscriptions=void 0,t.forEach((e=>{"subscribe"in e&&e.subscribe&&e.subscribe().then((t=>{e.unsubscribe=t,e.resolve()}))})));const s=this._queuedMessages;if(s){this._queuedMessages=void 0;for(const e of s)e.resolve()}this.fireEvent("ready")}addEventListener(e,t){let s=this.eventListeners.get(e);s||(s=[],this.eventListeners.set(e,s)),s.push(t)}removeEventListener(e,t){const s=this.eventListeners.get(e);if(!s)return;const n=s.indexOf(t);-1!==n&&s.splice(n,1)}fireEvent(e,t){(this.eventListeners.get(e)||[]).forEach((e=>e(this,t)))}suspendReconnectUntil(e){this.suspendReconnectPromise=e}suspend(){if(!this.suspendReconnectPromise)throw new Error("Suspend promise not set");this.socket&&this.socket.close()}reconnect(e=!1){this.socket&&(e?(this.socket.removeEventListener("message",this._handleMessage),this.socket.removeEventListener("close",this._handleClose),this.socket.close(),this._handleClose()):this.socket.close())}close(){this.closeRequested=!0,this.socket&&this.socket.close()}async subscribeEvents(e,t){return this.subscribeMessage(e,o.ku(t))}ping(){return this.sendMessagePromise(o.hU())}sendMessage(e,t){if(!this.connected)throw n.UD;if(this._queuedMessages){if(t)throw new Error("Cannot queue with commandId");this._queuedMessages.push({resolve:()=>this.sendMessage(e)})}else t||(t=this._genCmdId()),e.id=t,this.socket.send(JSON.stringify(e))}sendMessagePromise(e){return new Promise(((t,s)=>{if(this._queuedMessages)return void this._queuedMessages.push({reject:s,resolve:async()=>{try{t(await this.sendMessagePromise(e))}catch(e){s(e)}}});const n=this._genCmdId();this.commands.set(n,{resolve:t,reject:s}),this.sendMessage(e,n)}))}async subscribeMessage(e,t,s){let n;return this._queuedMessages&&await new Promise(((e,t)=>{this._queuedMessages.push({resolve:e,reject:t})})),await new Promise(((r,i)=>{const a=this._genCmdId();n={resolve:r,reject:i,callback:e,subscribe:!1!==(null==s?void 0:s.resubscribe)?()=>this.subscribeMessage(e,t):void 0,unsubscribe:async()=>{this.connected&&await this.sendMessagePromise(o.B1(a)),this.commands.delete(a)}},this.commands.set(a,n);try{this.sendMessage(t,a)}catch(e){}})),()=>n.unsubscribe()}_genCmdId(){return++this.commandId}}async function h(e){const t=Object.assign({setupRetry:0,createSocket:d},e),s=await t.createSocket(t);return new l(s,t)}},113:(e,t,s)=>{function n(e){return{type:"auth",access_token:e}}function o(){return{type:"supported_features",id:1,features:{coalesce_messages:1}}}function r(){return{type:"get_states"}}function i(){return{type:"auth/current_user"}}function a(e,t,s,n,o){const r={type:"call_service",domain:e,service:t,target:n,return_response:o};return s&&(r.service_data=s),r}function c(e){const t={type:"subscribe_events"};return e&&(t.event_type=e),t}function u(e){return{type:"unsubscribe_events",subscription:e}}function d(){return{type:"ping"}}function l(e,t){return{type:"result",success:!1,error:{code:e,message:t}}}s.d(t,{B1:()=>u,cb:()=>a,gQ:()=>o,hU:()=>d,j2:()=>n,kQ:()=>i,ku:()=>c,xP:()=>r,z3:()=>l})},953:(e,t,s)=>{function n(e){const t={},s=e.split("&");for(let e=0;e<s.length;e++){const n=s[e].split("="),o=decodeURIComponent(n[0]),r=n.length>1?decodeURIComponent(n[1]):void 0;t[o]=r}return t}s.d(t,{Y6:()=>o,mA:()=>n});const o=(e,t,s,n)=>{const[o,r,i]=e.split(".",3);return Number(o)>t||Number(o)===t&&(void 0===n?Number(r)>=s:Number(r)>s)||void 0!==n&&Number(o)===t&&Number(r)===s&&Number(i)>=n}}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var s=r[e]={exports:{}};return o[e](s,s.exports,i),s.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",s="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",n=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},i.a=(o,r,i)=>{var a;i&&((a=[]).d=-1);var c,u,d,l=new Set,h=o.exports,m=new Promise(((e,t)=>{d=t,u=e}));m[t]=h,m[e]=e=>(a&&e(a),l.forEach(e),m.catch((e=>{}))),o.exports=m,r((o=>{var r;c=(o=>o.map((o=>{if(null!==o&&"object"==typeof o){if(o[e])return o;if(o.then){var r=[];r.d=0,o.then((e=>{i[t]=e,n(r)}),(e=>{i[s]=e,n(r)}));var i={};return i[e]=e=>e(r),i}}var a={};return a[e]=e=>{},a[t]=o,a})))(o);var i=()=>c.map((e=>{if(e[s])throw e[s];return e[t]})),u=new Promise((t=>{(r=()=>t(i)).r=0;var s=e=>e!==a&&!l.has(e)&&(l.add(e),e&&!e.d&&(r.r++,e.push(r)));c.map((t=>t[e](s)))}));return r.r?u:i()}),(e=>(e?d(m[s]=e):u(h),n(a)))),a&&a.d<0&&(a.d=0)},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i(564)})();
//# sourceMappingURL=main.min.js.map